{% extends "!page.html" %}
{{ super() }}

{% block extrahead %}
<!-- Inter + Roboto Mono Font -->
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:ital,opsz,wght@0,14..32,100..900;1,14..32,100..900&family=Roboto+Mono:ital,wght@0,100..700;1,100..700&display=swap" rel="stylesheet">

<!-- Google Tag Manager -->
<script>
(function (w, d, s, l, i) {
    w[l] = w[l] || [];
    w[l].push({ "gtm.start": new Date().getTime(), event: "gtm.js" });
    var f = d.getElementsByTagName(s)[0],
        j = d.createElement(s),
        dl = l != "dataLayer" ? "&l=" + l : "";
    j.async = true;
    j.src = "https://www.googletagmanager.com/gtm.js?id=" + i + dl;
    f.parentNode.insertBefore(j, f);
})(window, document, "script", "dataLayer", "GTM-WC8V9XS");
</script>

<!-- UnionAI docs variant switcher -->
<script>
document.addEventListener("DOMContentLoaded", function() {
    const currentVariant = document.getElementById('unionai-docs-current-variant').textContent;
    const availableVariants = JSON.parse(document.getElementById('unionai-docs-available-variants').textContent);
    const variantDisplayNames = JSON.parse(document.getElementById('unionai-docs-variant-display-names').textContent);
    const m = new Map(Object.entries(variantDisplayNames));
    const allVariants = Array.from(m.keys());
    const currentUrl = new URL(window.location.href);
    const currentUrlSegments = currentUrl.pathname.split('/').filter(Boolean);
    const variantIndexInUrl = currentUrlSegments.indexOf(currentVariant);
    const variantLinks = [];

    allVariants.forEach(variant => {
        const prefixSegments = currentUrlSegments.slice(0, variantIndexInUrl);
        const suffixSegments = currentUrlSegments.slice(variantIndexInUrl + 1);
        const topUrlSegments = prefixSegments.concat([variant]);
        const peerUrlSegments = prefixSegments.concat([variant], suffixSegments);
        const topUrl = new URL(currentUrl);
        topUrl.pathname = '/' + topUrlSegments.join('/');
        const peerUrl = new URL(currentUrl);
        peerUrl.pathname = '/' + peerUrlSegments.join('/');

        const variantLink = {
            text: variantDisplayNames[variant],
            url: availableVariants.includes(variant) ? peerUrl.href : topUrl.href,
            isSelected: variant === currentVariant
        };
        variantLinks.push(variantLink);
    });

    // Update the new variant selector
    const dropdownContent = document.querySelector('.variant-dropdown-content');
    if (dropdownContent) {
        variantLinks.forEach(variantLink => {
            const anchor = document.createElement('a');
            anchor.textContent = variantLink.text;
            anchor.href = variantLink.url;
            if (variantLink.isSelected) {
                anchor.classList.add('selected');
            }
            dropdownContent.appendChild(anchor);
        });
    }

    // Update the variant text in the button
    const variantText = document.querySelector('.variant-text');
    if (variantText) {
        variantText.textContent = variantDisplayNames[currentVariant];
    }

    // Setup dropdown toggle functionality
    function setupVariantSelector() {
        document.addEventListener('click', function(event) {
            const dropdowns = document.querySelectorAll('.variant-dropdown-content');
            if (!event.target.closest('.variant-selector')) {
                dropdowns.forEach(dropdown => {
                    dropdown.classList.remove('show');
                });
            }
        });

        const variantButtons = document.querySelectorAll('.variant-dropdown-button');
        variantButtons.forEach(button => {
            button.addEventListener('click', function(event) {
                event.stopPropagation();
                const dropdown = this.nextElementSibling;
                const isOpen = dropdown.classList.contains('show');
                
                document.querySelectorAll('.variant-dropdown-content').forEach(d => {
                    d.classList.remove('show');
                });
                
                if (!isOpen) {
                    dropdown.classList.add('show');
                }
            });
        });

        document.querySelectorAll('.variant-dropdown-content').forEach(dropdown => {
            dropdown.addEventListener('click', function(event) {
                event.stopPropagation();
            });
        });
    }

    setupVariantSelector();
});
</script>
{% endblock %}

{% block body %}
{%- if meta is mapping %}
    <div id="unionai-docs-variant-display-names" style="display: none;">{{ meta.get("variant-display-names") }}</div>
    <div id="unionai-docs-available-variants" style="display: none;">{{ meta.get("available-variants") }}</div>
    <div id="unionai-docs-current-variant" style="display: none;">{{ meta.get("current-variant") }}</div>
{%- endif %}
{{ super() }}

<!-- Google Tag Manager (noscript) -->
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-WC8V9XS" height="0" width="0" style="display: none; visibility: hidden"></iframe></noscript>
<!-- End Google Tag Manager (noscript) -->
{% endblock %}